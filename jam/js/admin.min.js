(function(a,b){"use strict";function c(){var c={"ROOT_TYPE":1,"USERS_TYPE":2,"ROLES_TYPE":3,"TASKS_TYPE":4,"TASK_TYPE":5,"CATALOGS_TYPE":6,"JOURNALS_TYPE":7,"TABLES_TYPE":8,"REPORTS_TYPE":9,"CATALOG_TYPE":10,"JOURNAL_TYPE":11,"TABLE_TYPE":12,"REPORT_TYPE":13,"DETAIL_TYPE":14},d={"SQLITE":1,"FIREBIRD":2,"POSTGRESQL":3,"MYSQL":4};function e(d){b.btns_panel.hide();b.btns_panel.empty();b.view_panel.empty();d.task.cur_item_title=d.f_name.value;if(d.type_id.value===c.ROOT_TYPE){b.view_panel.append(a('<h4>'+b.language.admin+' - '+b.task_caption+'</h4>'));b.right_panel.show();l(d.task);}else if(d.type_id.value===c.USERS_TYPE){b.right_panel.hide();d.task.sys_users.view(b.view_panel);}else if(d.type_id.value===c.ROLES_TYPE){b.right_panel.hide();d.task.sys_roles.view(b.view_panel);}else{b.right_panel.show();d.task.sys_items.tree_changed(d.task.sys_items);}b.btns_panel.show();}function f(a,b){a.server('server_update_has_children',[]);a.item_tree.set_where({has_children:true});a.item_tree.open({fields:['id','parent','f_name','type_id','task_id']});a.item_tree.locate('type_id',c.TASK_TYPE);a.tree.expand(a.tree.selected_node);a.item_tree.on_after_scroll=e;if(b)a.item_tree.locate('id',b);else a.item_tree.locate('type_id',c.ROOT_TYPE);a.tree_panel.show();e(a.item_tree);}function g(b){var e,g;b.init_project=true;b.item_types=c;b.db_types=d;b.sys_params.open();if(!b.sys_params.f_language.value){b.sys_params.set_edit_fields(['f_language']);b.sys_params.edit_options.title='Project language';b.sys_params.edit_record();return;}b.sys_tasks.open();if(!b.sys_tasks.f_db_type.value){g=['f_name','f_item_name','f_db_type','f_alias','f_login','f_password','f_host','f_port','f_encoding'];b.sys_tasks.set_edit_fields(g);b.sys_tasks.edit_options.title=b.language.project_params;b.sys_tasks.edit_record();return;}if(b.sys_params.f_language.value&&b.sys_tasks.f_db_type.value){b.init_project=false;b.server('server_get_db_options',[b.sys_tasks.f_db_type.value],function(a){b.db_options=a;});b.buttons_info={divider:{},project_params:{handler:v,short_cut:'F2',key_code:113},project_locale:{handler:w,short_cut:'F3',key_code:114},db:{handler:x,short_cut:'F4',key_code:115},'export':{handler:D,short_cut:'Ctrl-E',key_code:69,key_ctrl:true},'import':{handler:C,short_cut:'Ctrl-I',key_code:73,key_ctrl:true},find:{handler:y,short_cut:'Alt-F',key_code:70,key_alt:true},print:{handler:A,short_cut:'Shift-P',key_code:80,key_shift:true},client_module:{handler:b.sys_items.edit_client,item:b.sys_items,short_cut:'F8',key_code:119},server_module:{handler:b.sys_items.edit_server,item:b.sys_items,short_cut:'F9',key_code:120},'index.html':{handler:b.sys_items.edit_index_html,item:b.sys_items,short_cut:'F10',key_code:121},'project.css':{handler:b.sys_items.edit_project_css,item:b.sys_items,short_cut:'F11',key_code:122},viewing:{handler:b.sys_items.view_setup,item:b.sys_items},editing:{handler:b.sys_items.edit_setup,item:b.sys_items},filters:{handler:b.sys_items.filters_setup,item:b.sys_items},details:{handler:b.sys_items.details_setup,item:b.sys_items},order:{handler:b.sys_items.order_setup,item:b.sys_items},indices:{handler:b.sys_items.indices_setup,item:b.sys_items},foreign_keys:{handler:b.sys_items.foreign_keys_setup,item:b.sys_items},reports:{handler:b.sys_items.reports_setup,item:b.sys_items},report_params:{handler:b.sys_items.report_params_setup,item:b.sys_items}};a("#title").html(b.item_caption);if(b.safe_mode){a("#user-info").text(b.user_info.role_name+' '+b.user_info.user_name);a('#log-out').show().click(function(a){a.preventDefault();b.logout();});}b.left_panel=a("#left-panel");b.center_panel=a("#center-panel");b.right_panel=a("#right-panel");b.btns_panel=a("#btns-panel");b.view_panel=a("#view-panel");b.tree_panel=a("#tree-panel");h(b);b.item_tree=b.sys_items.copy({handlers:false,details:false});b.tree=b.item_tree.create_tree(b.tree_panel,{id_field:'id',parent_field:'parent',text_field:'f_name',parent_of_root_value:0});b.tree.$element.height(a("#left-panel").height());f(b);K(b);a(window).on('resize',function(){J(b);});J(b);}}function h(a){var b=a.sys_items.copy();b.set_where({type_id:c.TASK_TYPE});b.open({fields:['f_item_name','f_name']});a.task_name=b.f_item_name.value;a.task_caption=b.f_name.value;}function i(b,c,d,e,f,g,h,i,j,k){function l(a){a.preventDefault();a.stopImmediatePropagation();a.stopPropagation();if(e)d.call(e,e,b.language[c]);else d.call(b,b,b.language[c]);}var m='',n='',o='',p;if(c){m=b.language[c];if(!m)m=c;}if(f)n='<i class="'+f+'"></i>';if(g)o='<small class="muted">&nbsp;['+g+']</small>';p=a('<button class="btn vert-btn text-center '+c+'" type="button">'+n+' '+m+o+'</button>');b.btns_panel.append(p);if(d)p.click(function(a){l(a);});if(h){a(window).off('keydown.'+c);a(window).on('keydown.'+c,(function(a){var b=(a.keyCode?a.keyCode:a.which);if(i&&a.ctrlKey&&h===a.keyCode||j&&a.shiftKey&&h===a.keyCode||k&&a.altKey&&h===a.keyCode||!i&&!j&&!k&&h===a.keyCode)l(a);}));}}function j(){b.btns_panel.append('<div class="btns-divider">');}function k(a,b){var c=0,d=b.length,e,f;for(;c<d;c++){e=b[c];if(e==='divider')j();else{f=a.buttons_info[e];i(a,e,f.handler,f.item,f.icon,f.short_cut,f.key_code,f.key_ctrl,f.key_shift,f.key_alt);}}}function l(a){k(a,['project_params','project_locale','divider','db','divider','export','import','divider','find','print']);}function m(b){var c,d,e=[];if(b.reports){for(var f=0;f<b.reports.length;f++)if(b.reports[f].can_view())e.push(b.reports[f]);if(e.length){c=b.view_form.find("#report-btn ul");for(var f=0;f<e.length;f++){d=a('<li><a href="#">'+e[f].item_caption+'</a></li>');d.find('a').data('report',e[f]);d.on('click','a',function(){a(this).data('report').print();});c.append(d);}}else b.view_form.find("#report-btn").hide();}else b.view_form.find("#report-btn").hide();}function n(a){var b=a.task,c,d,e;if(a.item_name==='sys_fields_editor'||a.item_name==='sys_code_editor')return;a.paginate=false;if(a.view_form.hasClass('modal')){a.view_form.find("#select-btn").on('click.task',function(){a.set_lookup_field_value();});a.view_options.width=960;d=480;if(a.item_name==='sys_items'||a.item_name==='sys_fields'){a.view_options.width=560;a.view_form.find('.modal-footer').hide();c={id:'10%'};}if(a.item_name==='sys_filters'||a.item_name==='sys_report_params'||a.item_name==='sys_indices'){a.view_options.width=680;d=460;}}else{b.cur_item=a;a.view_form.find(".modal-body").css('padding',0);a.view_form.find("#title-left").html('<h4>'+b.cur_item_title+'</h4>');a.view_form.find("#title-right").html('<h4>'+b.language.admin+' - '+b.task_caption+'</h4>');a.view_form.find("#select-btn").hide();d=b.center_panel.height()-b.view_panel.height();}if(a.item_name==='sys_items')c={id:'5%',f_visible:'10%',f_soft_delete:'10%'};if(a.item_name==='sys_report_params'){a.set_view_fields(['f_name','f_param_name','f_data_type','f_object','f_object_field','f_required','f_visible','f_alignment']);a.set_edit_fields(['f_name','f_param_name','f_data_type','f_object','f_object_field','f_required','f_visible','f_alignment']);}if(a.item_name!=="sys_roles"){a.view_form.find("#new-btn").text(a.task.language['new']).on('click.task',function(){a.append_record();});a.view_form.find("#edit-btn").text(a.task.language.edit).on('click.task',function(){a.edit_record();});a.view_form.find("#delete-btn").text(a.task.language['delete']).on('click.task',function(){a.delete_record();});e={height:d,word_wrap:false,column_width:c};if(a.init_view_table)a.init_view_table(a,e);a.view_table=a.create_table(a.view_form.find(".view-table"),e);}m(a);}function o(b){b.find(".modal-footer button.btn").each(function(){if(a(this).outerWidth()<100&&a(this).text())a(this).outerWidth(100);});}function p(a){o(a.view_form);if(a.item_name==='sys_fields_editor'||a.item_name==='sys_code_editor')return;if(a.item_name==='sys_items')a.open({fields:['id','deleted','parent','task_id','type_id','table_id','has_children','f_index','f_name','f_item_name','f_table_name','f_view_template','f_visible','f_soft_delete','f_virtual_table','f_js_external']});else a.open();}function q(a){if(a.item_name!=='sys_items'&&a.item_name!=='sys_code_editor'){a.edit_options.width=560;a.create_inputs(a.edit_form.find(".edit-body"));a.edit_form.find("#cancel-btn").text(a.task.language.cancel).attr("tabindex",101).on('click.task',function(b){a.cancel_edit(b);return false;});a.edit_form.find("#ok-btn").attr("tabindex",100).text(a.task.language.ok).on('click.task',function(){a.apply_record();});}}function r(a){o(a.edit_form);if(a.details_active)a.each_detail(function(a){a.update_controls();});else a.open_details();H(a);}function s(a){if(a.item_name!=='sys_search')if(a.is_changing())if(a.modified){a.yes_no_cancel(b.language.save_changes,function(){a.apply_record();},function(){a.cancel_edit();});return false;}else{a.cancel();return true;}}function t(a){a.filter_form.title=a.item_caption+' - filter';a.create_filter_inputs(a.filter_form.find(".edit-body"));a.filter_form.find("#cancel-btn").attr("tabindex",101).on('click.task',function(){a.close_filter();});a.filter_form.find("#ok-btn").attr("tabindex",100).on('click.task',function(){a.apply_filter();});}function u(a){a.create_param_inputs(a.param_form.find(".edit-body"));a.param_form.find("#cancel-btn").attr("tabindex",101).on('click.task',function(){a.close_param_form();});a.param_form.find("#ok-btn").attr("tabindex",100).on('click.task',function(){a.process_report();});}function v(a,b){a.sys_params.set_edit_fields(['f_safe_mode','f_debugging','f_con_pool_size','f_mp_pool','f_persist_con','f_compressed_js','f_single_file_js','f_dynamic_js','f_version']);a.sys_params.params=true;a.sys_params.edit_options.title=b;a.sys_params.edit_record();}function w(a,b){var c=['f_decimal_point','f_mon_decimal_point','f_mon_thousands_sep','f_currency_symbol','f_frac_digits','f_p_cs_precedes','f_n_cs_precedes','f_p_sep_by_space','f_n_sep_by_space','f_positive_sign','f_negative_sign','f_p_sign_posn','f_n_sign_posn','f_d_fmt','f_d_t_fmt'];a.sys_params.params=false;a.sys_params.set_edit_fields(c);a.sys_params.edit_options.title=b;a.sys_params.edit_record();}function x(a,b){var c=['f_manual_update','f_db_type','f_alias','f_login','f_password','f_host','f_port','f_encoding'];a.sys_tasks.on_field_changed(a.sys_tasks.f_db_type);a.sys_tasks.set_edit_fields(c);a.sys_tasks.f_name.required=false;a.sys_tasks.f_item_name.required=false;a.sys_tasks.edit_options.title=b;a.sys_tasks.edit_record();}function y(a){a.sys_search.find_in_task(a);}function z(b,c){var d,e,f,g,h=0,i,j;for(d=0;d<b.length;d++){c.append(a('<h4>'+b[d][0]+'</h4>'));i=b[d][1].split('\n');for(e=0;e<i.length;e++){g=i[e];h=0;for(f=0;f<g.length;f++)if(g[f]===' ')h+=1;else if(g[f]==='\t ')h+=4;else break;g=g.trim();if(g.length===0)j=a('<p style="line-height: 16px; margin: 0px;">').html('&nbsp;');else j=a('<p style="line-height: 16px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: '+h*6+'px">').text(g);j.css("font-family","'Courier New', Courier, monospace");c.append(j);}}}function A(b){var c=a(window).width()-50,d=a(window).height()-200,e=a('<div>'),f=b.server('server_web_print_code',[b.sys_tasks.task_id.value]);if(f){e.append(a('<h2>'+f.task+'</h2>'));e.append(a('<h3>Client</h3>'));z(f.client,e);e.append(a('<h3>Server</h3>'));z(f.server,e);b.message(e,{title:'Project code',margin:10,width:c,height:d,text_center:false,buttons:{"Close":undefined},center_buttons:false,print:true});}}function B(a,b){var c=a.server('server_import_task',[a.sys_tasks.task_id.value,'static/internal/'+b,true]);if(c)a.warning(c);}function C(a){a.upload('static/internal',{multiple:false,callback:B});}function D(a){var b,c=location.protocol+'/'+'/'+location.hostname+(location.port?':'+location.port:''),d=a.server('server_export_task',[a.sys_tasks.task_id.value,c]);window.open(d,"_self");}function E(a,b,c){var d=a._records[b],e=a._records[c],f,g;for(f=0;f<d.length-1;f++){g=d[f];d[f]=e[f];e[f]=g;}a.update_controls();a.rec_no=c;}function F(a){if(a.rec_no>0)E(a,a.rec_no,a.rec_no-1);}function G(a){if(a.rec_no<a.record_count()-1)E(a,a.rec_no,a.rec_no+1);}function H(b,c){var d,e,f;if(b.edit_form&&b.edit_table){d=b.edit_form.height();e=a(window).height();if(c||d>e-20){f=b.edit_table.height()-(d-e)-20;if(f>450)f=450;if(f<200)f=200;b.edit_table.height(f);b.update_controls();}}}var I;function J(b){clearTimeout(I);I=setTimeout(function(){var c=b.left_panel.height()+a(window).height()-a('body').height()-40;b.left_panel.height(c);b.tree.height(c);b.btns_panel.height(c);if(b.cur_item)b.cur_item.view_table.height(c-74);if(b.code_editor_item)b.code_editor_item.resize(b.code_editor_item);},100);}function K(b){if(b.sys_tasks.f_manual_update.value)a("#project-mode").text('DB manual mode').css("color","red");else a("#project-mode").text('');}function L(a,b){if(a.item_name==='sys_users'||a.item_name==='sys_report_params'||a.item_name==='sys_filters')if(b.keyCode===45&&b.ctrlKey===true){b.preventDefault();a.append_record();}else if(b.keyCode===46&&b.ctrlKey===true){b.preventDefault();a.delete_record();}}function M(a,b){if(a.item_name==='sys_users'||a.item_name==='sys_indices'||a.item_name==='sys_report_params'||a.item_name==='sys_filters')if(b.keyCode===13&&b.ctrlKey===true){b.preventDefault();a.edit_form.find("#ok-btn").focus();a.apply_record();}}this.tree_changed=e;this.refresh_tree=f;this.on_page_loaded=g;this.read_task_name=h;this.add_button=i;this.add_divider=j;this.add_buttons=k;this.create_params_btn=l;this.create_print_btns=m;this.on_view_form_created=n;this.expand_buttons=o;this.on_view_form_shown=p;this.on_edit_form_created=q;this.on_edit_form_shown=r;this.on_edit_form_close_query=s;this.on_filter_form_created=t;this.on_param_form_created=u;this.set_project_params=v;this.set_locale_params=w;this.edit_database=x;this.find_in_task=y;this.print_section=z;this.print_code=A;this.do_import=B;this.import_task=C;this.export_task=D;this.move_vert=E;this.move_record_up=F;this.move_record_down=G;this.resize_edit_table=H;this.resize=J;this.update_db_manual_mode=K;this.on_view_form_keydown=L;this.on_edit_form_keydown=M;}b.events.events0=new c();function d(){function a(a){var b=a.task;if(b.item_tree.type_id.value===b.item_types.TASKS_TYPE){a.set_view_fields(['id','f_name','f_item_name'],['ID',b.language.caption,b.language.name]);a.set_edit_fields(['f_name','f_item_name'],[b.language.caption,b.language.name]);b.add_buttons(b,['client_module','server_module','index.html','project.css']);return true;}}function c(a){var b=a.task;if(b.item_tree.type_id.value===b.item_types.TASK_TYPE){a.fields_editor=true;a.set_view_fields(['id','f_name','f_item_name'],['ID',b.language.caption,b.language.name]);a.set_edit_fields(['f_name','f_item_name'],[b.language.caption,b.language.name]);a.sys_fields.set_view_fields(['f_name','f_field_name','f_data_type','f_size','f_object','f_object_field','f_master_field','f_required','f_default','f_read_only','f_alignment'],[b.language.caption,b.language.name,b.language.data_type,b.language.size,b.language.object,b.language.object_field,b.language.master_field,b.language.required,b.language['default'],b.language.read_only,b.language.alignment]);a.sys_fields.set_edit_fields(['f_name','f_field_name','f_data_type','f_size','f_object','f_object_field','f_master_field','f_required','f_read_only','f_alignment','f_default'],[b.language.caption,b.language.name,b.language.data_type,b.language.size,b.language.object,b.language.object_field,b.language.master_field,b.language.required,b.language.read_only,b.language.alignment,b.language['default']]);b.add_buttons(b,['client_module','server_module']);return true;}}function d(a){var b=a.task;if(b.item_tree.type_id.value===b.item_types.CATALOGS_TYPE||b.item_tree.type_id.value===b.item_types.JOURNALS_TYPE||b.item_tree.type_id.value===b.item_types.TABLES_TYPE){a.fields_editor=true;a.set_view_fields(['id','f_name','f_item_name','f_table_name','f_visible','f_soft_delete'],['ID',b.language.caption,b.language.name,b.language.table_name,b.language.visible,'Soft delete']);a.set_edit_fields(['f_name','f_item_name','f_visible','f_soft_delete','f_table_name','f_virtual_table','f_js_external'],[b.language.caption,b.language.name,b.language.visible,'Soft delete',b.language.table_name,'Virtual_table','External js module']);a.sys_fields.set_view_fields(['f_name','f_field_name','f_data_type','f_size','f_object','f_object_field','f_master_field','f_enable_typehead','f_required','f_read_only','f_alignment','f_default'],[b.language.caption,b.language.name,b.language.data_type,b.language.size,b.language.object,b.language.object_field,b.language.master_field,'Typeahead',b.language.required,b.language.read_only,b.language.alignment,b.language['default']]);a.sys_fields.set_edit_fields(['f_name','f_field_name','f_data_type','f_size','f_object','f_object_field','f_master_field','f_enable_typehead','f_required','f_read_only','f_alignment','f_default'],[b.language.caption,b.language.name,b.language.data_type,b.language.size,b.language.object,b.language.object_field,b.language.master_field,'Typeahead',b.language.required,b.language.read_only,b.language.alignment,b.language['default']]);b.add_buttons(b,['client_module','server_module','divider','viewing','editing','filters','divider','details','divider','order','indices','foreign_keys','divider','reports']);return true;}}function e(a){var b=a.task;if(b.item_tree.type_id.value===b.item_types.CATALOG_TYPE||b.item_tree.type_id.value===b.item_types.JOURNAL_TYPE||b.item_tree.type_id.value===b.item_types.TABLE_TYPE){a.set_view_fields(['id','f_name','f_item_name','f_table_name'],['ID',b.language.caption,b.language.name,b.language.table_name]);a.set_edit_fields(['f_name','f_item_name'],[b.language.caption,b.language.name]);b.add_buttons(b,['client_module','server_module','divider','viewing','editing','divider','order']);return true;}}function f(a){var b=a.task;if(b.item_tree.type_id.value===b.item_types.REPORTS_TYPE){a.set_view_fields(['id','f_name','f_item_name','f_view_template','f_visible'],['ID',b.language.caption,b.language.name,b.language.template,b.language.visible]);a.set_edit_fields(['f_name','f_item_name','f_view_template','f_visible','f_js_external'],[b.language.caption,b.language.name,b.language.template,b.language.visible,'External js module']);b.add_buttons(b,['client_module','server_module','divider','report_params']);return true;}}function g(b){b.fields_editor=false;return a(b)||c(b)||d(b)||e(b)||f(b);}function h(a){var b=a.task,c=a.task.item_tree,d;a.filters.parent.value=c.id.value;g(a);a.view(b.view_panel);}function i(a){var b=a.task.item_tree.type_id.value,c=a.task.item_types,d=a.task;if(b===c.TASKS_TYPE)return c.TASK_TYPE;else if(b===c.CATALOGS_TYPE)return c.CATALOG_TYPE;else if(b===c.JOURNALS_TYPE)return c.JOURNAL_TYPE;else if(b===c.TABLES_TYPE)return c.TABLE_TYPE;else if(b===c.REPORTS_TYPE)return c.REPORT_TYPE;else if(b===c.CATALOG_TYPE||b===c.JOURNAL_TYPE||b===c.TABLE_TYPE)return c.DETAIL_TYPE;}function j(a){var b=0,c=a.rec_no;try{a.each(function(a){a.edit();a.f_index.value=b;a.post();b++;});a.apply();}finally{a.rec_no=c;}}function k(a){var b=a.task.item_tree.type_id.value,c=a.task.item_types;if(b===c.TASKS_TYPE||b===c.TASK_TYPE||i(a)===c.DETAIL_TYPE){a.view_form.find('#new-btn').hide();a.view_form.find('#delete-btn').hide();a.view_form.find('#up-btn').hide();a.view_form.find('#down-btn').hide();}a.view_form.find('#delete-btn').off('click.task').on('click',function(){a.question(a.task.language.delete_record,function(){var b=r(a);if(b)a.warning(b);else{a["delete"]();a.apply();}});});a.view_form.find('#up-btn').click(function(){a.task.move_record_up(a);j(a);});a.view_form.find('#down-btn').click(function(){a.task.move_record_down(a);j(a);});}function l(a){var c=a.task.item_tree.type_id.value,d=a.task.item_types,e=1,f=400,g=560,h=a.task.item_tree;a.f_item_name.read_only=b.item_tree.type_id.value===b.item_types.TASK_TYPE;if(a.fields_editor){e=1;g=1050;}a.edit_options.title='Item Editor';if(!a.is_new())a.edit_options.title+=' - '+a.f_name.value;a.edit_options.width=g;if(a.fields_editor)a.create_inputs(a.edit_form.find(".field-container"),{col_count:e});else a.create_inputs(a.edit_form.find(".edit-body"),{col_count:e});a.edit_form.find("#cancel-btn").attr("tabindex",101).on('click.task',function(b){a.cancel_edit(b);return false;});a.edit_form.find("#ok-btn").attr("tabindex",100).on('click.task',function(){a.apply_record();});if(a.item_name==='sys_items')if(a.fields_editor){if(c===d.TASK_TYPE){f=520;a.edit_form.find("#new-btn").prop("disabled",true);a.edit_form.find("#delete-btn").prop("disabled",true);}a.edit_table=a.sys_fields.create_table(a.edit_form.find(".edit-detail"),{height:f,tabindex:90,sortable:true});a.edit_form.find("#new-btn").attr("tabindex",92).on('click.task',function(){a.sys_fields.append_record();});a.edit_form.find("#edit-btn").attr("tabindex",91).on('click.task',function(){a.sys_fields.edit_record();});a.edit_form.find("#delete-btn").attr("tabindex",90).off('click.task').on('click',function(){a.question(a.task.language.delete_record,function(){var b=a.sys_fields.can_delete(a.sys_fields);if(b)a.warning(b);else{a.sys_fields["delete"]();a.sys_fields.apply();}});});}else a.edit_form.find('#edit-detail-footer').hide();}function m(a){a.f_visible.value=true;a.f_soft_delete.value=true;a.parent.value=a.task.item_tree.id.value;a.task_id.value=a.task.item_tree.task_id.value;a.table_id.value=0;a.f_index.value=a.record_count();a.type_id.value=i(a);}function n(a){var b=a.owner,c,d=b.task.item_types,e=[],f=[],g,h,i,j,k;if(a.field_name==='f_item_name'){if(!b.valid_identifier(a.value))return b.task.language.invalid_name;f.push(b.parent.value);if(b.type_id.value!==d.DETAIL_TYPE)e.push(d.TASK_TYPE);if(b.type_id.value===d.CATALOG_TYPE||b.type_id.value===d.JOURNAL_TYPE||b.type_id.value===d.TABLE_TYPE||b.type_id.value===d.REPORT_TYPE){e.push(d.CATALOGS_TYPE);e.push(d.JOURNALS_TYPE);e.push(d.TABLES_TYPE);e.push(d.REPORTS_TYPE);}c=b.copy({handlers:false,details:false});if(e.length){c.set_where({type_id__in:e});c.open();c.each(function(a){f.push(a.id.value);});}c.set_where({parent__in:f});c.open();c.each(function(c){if(c.id.value!==b.id.value&&c.f_item_name.value===a.value){k='There is an item with this name';return false;}});if(k)return k;if(b.type_id.value===d.CATALOG_TYPE||b.type_id.value===d.JOURNAL_TYPE||b.type_id.value===d.TABLE_TYPE||b.type_id.value===d.REPORT_TYPE){h=new b.task.constructors.item();if(h[a.value]!==undefined)return b.task.language.reserved_word;}if(b.type_id.value===d.CATALOGS_TYPE||b.type_id.value===d.JOURNALS_TYPE||b.type_id.value===d.TABLES_TYPE||b.type_id.value===d.REPORTS_TYPE){i=new b.task.constructors.group();if(i[a.value]!==undefined)return b.task.language.reserved_word;}if(b.type_id.value===d.TASK_TYPE){j=new b.task.constructors.task();if(j[a.value]!==undefined)return b.task.language.reserved_word;}if(b.type_id.value===d.DETAIL_TYPE){g=new b.task.constructors.detail();if(g[a.value]!==undefined)return b.task.language.reserved_word;}}}function o(a,b){var c,d,e=a.owner;if(e.is_new()&&(e.type_id.value===e.task.item_types.CATALOG_TYPE||e.type_id.value===e.task.item_types.JOURNAL_TYPE||e.type_id.value===e.task.item_types.TABLE_TYPE||e.type_id.value===e.task.item_types.REPORT_TYPE)){if(a.field_name=='f_item_name'){c=e.copy({handlers:false,details:false});c.set_where({type_id:e.task.item_types.TASK_TYPE});c.open();if(c.record_count()===1)e.f_table_name.value=c.f_item_name.value+'_'+a.value;}if(a.field_name==='f_name'&&!e.f_item_name.value)try{d=a.text.replace(' ','_').toLowerCase();if(p(d))e.f_item_name.value=d;}catch(f){}}}function p(a){function b(a){return a.charCodeAt(0)>=97&&a.charCodeAt(0)<=122;}function c(a){return a.charCodeAt(0)>=48&&a.charCodeAt(0)<=57;}var d,e=a.length;if(a[0]==='_'||b(a[0])){for(d=1;d<e;d++)if(!(a[d]==='_'||b(a[d])||c(a[d])))return false;return true;}return false;}function q(a){var c;clearTimeout(c);c=setTimeout(function(){b.btns_panel.find('button').prop("disabled",a.record_count()===0);if(a.record_count()&&a.f_table_name&&a.f_virtual_table){a.f_table_name.read_only=!a.is_new();a.f_virtual_table.read_only=!a.is_new();b.btns_panel.find('button.indices').prop("disabled",a.f_virtual_table.value);b.btns_panel.find('button.foreign_keys').prop("disabled",a.f_virtual_table.value);}},100);}function r(a){if(a.type_id.value===a.task.item_types.CATALOGS_TYPE||a.type_id.value===a.task.item_types.JOURNALS_TYPE||a.type_id.value===a.task.item_types.TABLES_TYPE)return a.task.language.cant_delete_group;if(a.id.value)return a.server('server_can_delete',[a.id.value]);}function s(a){var b=a.sys_items,c=b.copy(),d=b.task.sys_fields.copy(),e,f=[];if(b.table_id.value===0)d.set_where({owner_rec_id__in:[b.id.value,b.parent.value]});else{c.set_where({id:b.table_id.value});c.open({fields:['id','parent']});e=c.parent.value;d.set_where({owner_rec_id__in:[b.table_id.value,e]});}d.open({fields:['id','f_field_name']});d.each(function(a){f.push([a.id.value,a.f_field_name.value]);});return f;}function t(a){var b,c=[],d=[],e,f;function g(a,c){b.view_list=c;a.server('server_store_interface',[a.id.value,b]);}b=a.server('server_load_interface',[a.id.value]);c=[['id','',false],['name',a.task.language.caption_name,true]];d=[['id','',false],['name',a.task.language.caption_name,true,'60%'],['param1',a.task.language.caption_word_wrap,false],['param2',a.task.language.caption_expand,false],['param3',a.task.language.caption_edit,false]];f=a.f_name.value+' - '+a.task.language.viewing;a.task.sys_fields_editor.fields_editor(a,f,c,s(a.task),d,b.view_list,g);}function u(a){var b,c=[],d=[],e,f;function g(a,c){b.edit_list=c;a.server('server_store_interface',[a.id.value,b]);}b=a.server('server_load_interface',[a.id.value]);c=[['id','',false],['name',a.task.language.caption_name,true]];d=[['id','',false],['name',a.task.language.caption_name,true]];f=a.f_name.value+' - '+a.task.language.editing;a.task.sys_fields_editor.fields_editor(a,f,c,s(a.task),d,b.edit_list,g);}function v(a,b){a.task.sys_code_editor.code_editor(a,b);}function w(a,b){a.task.sys_code_editor.file_editor(a,b);}function x(a){v(a,'f_web_client_module');}function y(a){v(a,'f_server_module');}function z(a){w(a,'index.html');}function A(a){w(a,'project.css');}function B(a){var c=[],d=a.copy({handlers:false});d.set_where({type_id:b.item_types.TABLE_TYPE});d.open();d.each(function(a){c.push([a.id.value,a.f_item_name.value]);});return c;}function C(a){var b=[],c=a.copy({handlers:false});c.set_where({parent:a.id.value});c.open();c.each(function(a){b.push([a.table_id.value]);});return b;}function D(a){var b,c=[],d=[],e=B(a),f=C(a),g;function h(a,b){if(JSON.stringify(f)!==JSON.stringify(b)){a.server('server_update_details',[a.id.value,b]);a.task.refresh_tree(a.task);}}c=[['id','',false],['name',a.task.language.caption_name,true]];d=[['id','',false],['name',a.task.language.caption_name,true]];g=a.f_name.value+' - '+a.task.language.details;a.task.sys_fields_editor.fields_editor(a,g,c,e,d,f,h,undefined,false);}function E(a){var b,c=[],d=[],e,f;function g(a,c){b.order_list=c;a.server('server_store_interface',[a.id.value,b]);}b=a.server('server_load_interface',[a.id.value]);c=[['id','',false],['name',a.task.language.caption_name,true]];d=[['id','',false],['name',a.task.language.caption_name,true,'80%'],['param1',a.task.language.caption_descening,true]];f=a.f_name.value+' - '+a.task.language.order;a.task.sys_fields_editor.fields_editor(a,f,c,s(a.task),d,b.order_list,g);}function F(a){var b,c=[],d=a.copy({handlers:false});d.set_where({type_id:a.task.item_types.REPORTS_TYPE});d.open();b=d.id.value;d.set_where({parent:b});d.open();d.each(function(a){c.push([a.id.value,a.f_name.value]);});return c;}function G(a){var b,c=[],d=[],e,f;function g(a,c){b.reports_list=c;a.server('server_store_interface',[a.id.value,b]);}b=a.server('server_load_interface',[a.id.value]);c=[['id','',false],['name',a.task.language.caption_name,true]];d=[['id','',false],['name',a.task.language.caption_name,true]];f=a.f_name.value+' - '+a.task.language.reports;a.task.sys_fields_editor.fields_editor(a,f,c,F(a),d,b.reports_list,g);}function H(a){a.task.sys_filters.filters.owner_rec_id.value=a.id.value;a.task.sys_filters.open();a.task.sys_filters.set_view_fields(['f_name','f_filter_name','f_type','f_field','f_visible']);a.task.sys_filters.set_edit_fields(['f_field','f_name','f_filter_name','f_type','f_visible']);a.task.sys_filters.view_options.title=a.f_name.value+' - Filters';a.task.sys_filters.view();}function I(a){a.task.sys_indices.filters.owner_rec_id.value=a.id.value;a.task.sys_indices.filters.foreign_index.value=false;a.task.sys_indices.open();a.task.sys_indices.view_options.title=a.f_name.value+' - Indices';a.task.sys_indices.view();}function J(a){a.task.sys_indices.filters.owner_rec_id.value=a.id.value;a.task.sys_indices.filters.foreign_index.value=true;a.task.sys_indices.open();a.task.sys_indices.view_options.title=a.f_name.value+' - Foreign keys';a.task.sys_indices.view();}function K(a){a.task.sys_report_params.filters.owner_rec_id.value=a.id.value;a.task.sys_report_params.open();a.task.sys_report_params.set_view_fields(['f_name','f_param_name','f_data_type','f_object','f_object_field','f_required','f_alignment']);a.task.sys_report_params.set_edit_fields(['f_name','f_param_name','f_data_type','f_object','f_object_field','f_required','f_alignment']);a.task.sys_report_params.view_options.title=a.f_name.value+' - Params';a.task.sys_report_params.view();}function L(a,b){if(b.keyCode===45&&b.ctrlKey===true){b.preventDefault();a.append_record();}else if(b.keyCode===46&&b.ctrlKey===true){b.preventDefault();a.delete_record();}}function M(a,b){if(b.keyCode===13&&b.ctrlKey===true){b.preventDefault();a.edit_form.find("#ok-btn").focus();a.apply_record();}if(b.keyCode===45&&b.ctrlKey===true){b.preventDefault();a.sys_fields.append_record();}else if(b.keyCode===46&&b.ctrlKey===true){b.preventDefault();a.sys_fields.delete_record();}}function N(a){a.refresh_record();q(a);}this.init_task=a;this.init_groups=c;this.init_items=d;this.init_details=e;this.init_reports=f;this.init=g;this.tree_changed=h;this.get_type_id=i;this.save_order=j;this.on_view_form_created=k;this.on_edit_form_created=l;this.on_after_append=m;this.on_field_validate=n;this.on_field_changed=o;this.valid_identifier=p;this.on_after_scroll=q;this.can_delete=r;this.get_fields_list=s;this.view_setup=t;this.edit_setup=u;this.edit_code=v;this.edit_file=w;this.edit_client=x;this.edit_server=y;this.edit_index_html=z;this.edit_project_css=A;this.get_detail_source_list=B;this.get_detail_dest_list=C;this.details_setup=D;this.order_setup=E;this.get_reports_list=F;this.reports_setup=G;this.filters_setup=H;this.indices_setup=I;this.foreign_keys_setup=J;this.report_params_setup=K;this.on_view_form_keydown=L;this.on_edit_form_keydown=M;this.on_after_apply=N;}b.events.events3=new d();function e(){function a(a,b){a.set_view_fields(['f_login','f_password','f_role','f_admin'],[a.task.language.login,a.task.language.password,a.task.language.role,'Admin']);}this.init_view_table=a;}b.events.events1=new e();function f(){function b(b){var g=b.task.center_panel.height()-b.task.view_panel.height();if(b.view_form.hasClass('modal')){g=460;b.view_options.width=560;b.view_form.find("#priv-panel").remove();b.view_form.find("#roles-panel").removeClass('span4').addClass('span12');b.view_form.find("#roles-footer").hide();b.view_table=b.create_table(b.view_form.find("#roles-panel .view-table"),{height:g,fields:['id','f_name'],column_width:{id:'10%'}});}else{b.view_form.find("#roles-panel #new-btn").text(b.task.language['new']).on('click.task',function(){f(b);});b.view_form.find("#roles-panel #delete-btn").text(b.task.language['delete']).on('click.task',function(){e(b);});b.view_form.find("#select-all-btn").text(b.task.language.select_all).on('click.task',function(){c(b);});b.view_form.find("#unselect-all-btn").text(b.task.language.unselect_all).on('click.task',function(){d(b);});b.set_view_fields(['f_name'],[b.task.language.roles]);b.view_table=b.create_table(b.view_form.find("#roles-panel .view-table"),{height:g,fields:['id','f_name'],word_wrap:false,sortable:false});b.sys_privileges.set_view_fields(['item_id','f_can_view','f_can_create','f_can_edit','f_can_delete'],[b.task.language.item,b.task.language.can_view,b.task.language.can_create,b.task.language.can_edit,b.task.language.can_delete]);b.detail_table=b.sys_privileges.create_table(b.view_form.find("#priv-panel .view-table"),{height:g,word_wrap:true,column_width:{item_id:'50%'},sortable:false,dblclick_edit:false});b.detail_table.$table.on('click','td',function(){var c=a(this),d=c.data('field_name'),e=b.sys_privileges.field_by_name(d);if(e.field_type==="boolean"){if(!b.sys_privileges.is_changing())b.sys_privileges.edit();e.value=!e.value;}});}}function c(a,b){var c=a.details.sys_privileges,d=c.on_field_changed,e=c.rec_no;if(b===undefined)b=true;if(!a.is_changing())a.edit();try{c.on_field_changed=undefined;c.disable_controls();c.each(function(c){c.edit();c.f_can_create.value=b;c.f_can_view.value=b;c.f_can_edit.value=b;c.f_can_delete.value=b;if(c.id.value)c.record_status=a.task.consts.RECORD_MODIFIED;else c.record_status=a.task.consts.RECORD_INSERTED;c.post();});}finally{c.on_field_changed=d;c.rec_no=e;c.enable_controls();}if(a.is_changing()){a.post();a.apply();a.edit();}c.open();}function d(a){c(a,false);}function e(a){if(a.is_changing())a.cancel();a.delete_record();}function f(a){if(a.is_changing()){a.post();a.apply();}a.append_record();}function g(a){if(a.is_changing()){a.post();a.apply();}}var h;function i(a){clearTimeout(h);h=setTimeout(function(){a.sys_privileges.open();if(a.is_browsing())a.edit();},50);}function j(a){a.server('roles_changed');}this.on_view_form_created=b;this.select_all_clicked=c;this.unselect_all_clicked=d;this.del_role=e;this.append_role=f;this.on_before_scroll=g;this.on_after_scroll=i;this.on_after_apply=j;}b.events.events2=new f();function g(){function a(a){if(b.init_project&&a.f_db_type.value)a.task.on_page_loaded(a.task);a.task.update_db_manual_mode(a.task);}function c(a,c){var d=a.owner,e;if(a==a.owner.f_db_type){e=d.task.server('server_get_db_options',[a.owner.f_db_type.value]);b.db_options=e;if(a.owner.is_changing()){a.owner.f_alias.value=null;a.owner.f_login.value=null;a.owner.f_password.value=null;a.owner.f_encoding.value=null;a.owner.f_host.value=null;a.owner.f_port.value=null;}a.owner.f_login.read_only=!e.NEED_DATABASE_NAME;a.owner.f_login.read_only=!e.NEED_LOGIN;a.owner.f_password.read_only=!e.NEED_PASSWORD;a.owner.f_encoding.read_only=!e.NEED_ENCODING;a.owner.f_host.read_only=!e.NEED_HOST;a.owner.f_port.read_only=!e.NEED_PORT;}}function d(a){var c=a.task.server('server_check_connection',[a.f_db_type.value,a.f_alias.value,a.f_login.value,a.f_password.value,a.f_host.value,a.f_port.value,a.f_encoding.value]);if(c){a.warning(c);a.abort();}if(b.init_project)a.task.server('server_set_task_name',[a.f_name.value,a.f_item_name.value]);}function e(a){var b=a.owner;if(a.field_name==='f_item_name'&&a.required)if(!b.task.sys_items.valid_identifier(a.value))return b.task.language.invalid_name;if(a.field_name==='f_port'&&a.value)if(isNaN(a.value))return 'The port must be an integer value.';}this.on_after_apply=a;this.on_field_changed=c;this.on_before_post=d;this.on_field_validate=e;}b.events.events9=new g();function h(){function c(a,b){var c=this.copy();c.item=a;c.field_name=b;c.is_server=b==='f_server_module';c.item_info=a.task.server('server_item_info',[a.task.sys_items.id.value,c.is_server]);c.view();}function d(a,b){var c=this.copy();c.item=a;c.file_name=b;c.item_info=a.task.server('server_get_file_info',[b]);c.view();}function e(a){b.code_editor_item=a;a.view_form.find("#left-box").width(250);a.view_form.find("#right-box").hide();a.view_form.find("#cancel-btn").attr("tabindex",101).on('click',function(b){m(a);});a.view_form.find("#ok-btn").attr("tabindex",100).on('click',function(){l(a);});a.view_form.find("#find-btn").attr("tabindex",99).on('click',function(){v(a);});n(a);}function f(b){if(b.field_name){b.view_form.find('h4.modal-title').text('Code Editor - '+b.item_info.module_name);b.view_form.find('#editor-tabs ul').append('<li id="module"><a href="#">Module</a></li>').append('<li id="events"><a href="#">Events</a></li>').append('<li id="task"><a href="#">Task</a></li>').append('<li id="fields"><a href="#">Fields</a></li>');t(b,"Module");t(b,"Events");t(b,"Task");t(b,"Fields");b.view_form.find('#editor-tabs #info-grids').height(b.view_form.find('#left-box').innerHeight()-b.view_form.find('ul.nav-tabs').outerHeight()-14);s(b,b.view_form.find('li#module'));b.editor=ace.edit("editor");b.editor.$blockScrolling=Infinity;if(b.is_server){b.is_server_module=true;b.editor.getSession().setMode("ace/mode/python");b.editor.getSession().setUseSoftTabs(true);}else b.editor.getSession().setMode("ace/mode/javascript");}else if(b.file_name){b.view_form.find('h4.modal-title').text('Editor '+b.file_name);if(b.item_info.Templates){b.view_form.find('#editor-tabs ul').append('<li id="templates"><a href="#">Templates</a></li>');t(b,"Templates");b.view_form.find('#editor-tabs #info-grids').height(b.view_form.find('#left-box').innerHeight()-b.view_form.find('ul.nav-tabs').outerHeight()-14);s(b,b.view_form.find('li#templates'));}else b.view_form.find("#left-box").hide();b.editor=ace.edit("editor");b.editor.$blockScrolling=Infinity;if(b.file_name==='index.html')b.editor.getSession().setMode("ace/mode/html");else b.editor.getSession().setMode("ace/mode/css");}b.loaded=true;b.editor.session.setValue(b.item_info.code);b.editor.gotoLine(1);b.view_form.find('#ok-btn').prop("disabled",true);b.editor.on('input',function(){b.view_form.find("#error-info").text('');if(b.loaded){b.loaded=false;h(b);return;}if(g(b))b.view_form.find('#ok-btn').prop("disabled",false);else b.view_form.find('#ok-btn').prop("disabled",true);});b.view_form.on('click','#editor-tabs > .nav > li',function(){s(b,a(this));});b.view_form.on('dblclick','.dbtree ul li',function(c){c.preventDefault();c.stopPropagation();q(b,a(this));});a(b.editor).focus();setTimeout(function(){b.view_form.off('keyup.dismiss.modal');a(b.editor).focus();},100);}function g(a){return !a.editor.session.getUndoManager().isClean();}function h(a){a.editor.session.getUndoManager().markClean();}function i(a){if(g(a)){a.yes_no_cancel(b.language.save_changes,function(){l(a);a.close_view_form();},function(){h(a);a.close_view_form();});return false;}else{b.code_editor_item=undefined;a.editor.destroy();return true;}}function j(a){var b=a.task.server('server_save_edit',[a.task.sys_items.id.value,a.editor.getValue(),a.is_server]),c=b[0],d=b[1],e=b[2];if(c&&d&&d<a.editor.session.getLength())a.editor.gotoLine(d);if(!c){a.item_info.Module=e;t(a,"Module");r(a);}return c;}function k(a){var b=a.task.server('server_save_file',[a.file_name,a.editor.getValue()]),c=b.error;if(b.Templates){a.item_info.Templates=b.Templates;t(a,"Templates");r(a);}}function l(a){var b=false;if(a.field_name)b=j(a);else if(a.file_name)b=k(a);if(b)a.view_form.find("#error-info").text(b);else{a.view_form.find("#error-info").text('');h(a);a.view_form.find('#ok-btn').prop("disabled",true);}}function m(a){h(a);a.close_view_form();}function n(b){var c;b.view_options.width=a(window).width()-50;c=a(window).height()-200;b.view_form.find("#editor-box").height(c);}function o(b){var c;c=a(window).height()-200;b.view_options.width=a(window).width()-50;b.view_form.data('modal').layout();}function p(a,b){return a.editor.find(b,{backwards:false,wrap:false,caseSensitive:true,wholeWord:true,regExp:false});}function q(a,b){var c=b.closest('.info-tree').attr('id'),d=b.find('span.tree-text:first').text(),e,f,g;if(c==='module'){a.editor.gotoLine(1);if(a.is_server_module)e='def '+d;else e='function '+d;f=p(a,e);}else if(c==='events'){a.editor.gotoLine(1);if(!p(a,d+'(')){g=a.item_info.Events[d];a.editor.gotoLine(a.editor.session.getLength()+1);if(a.is_server_module)e='def '+d+'('+g+'):\n\tpass';else e='function '+d+'('+g+') {\n\n}';a.editor.insert('\n\n'+e);}}else if(c==='task'||c==='fields')a.editor.insert(d);else if(c==='templates'){a.editor.gotoLine(1);e=d;p(a,e);}a.editor.focus();}function r(a){var b,c,d;b=a.view_form.find('#editor-tabs > .nav > li.active');if(b.length){d=a.view_form.find('#editor-tabs #info-grids').innerHeight();a.view_form.find('#editor-tabs div.info-tree').hide();a.view_form.find('#editor-tabs div.info-tree.'+b.attr('id')).show().height(d).find('.dbtree').height(d);c=a.view_form.find('#editor-tabs div.info-tree.'+b.attr('id')).find('.dbtree').data('tree');if(c)c.scroll_into_view();}}function s(a,b){var c;a.view_form.find('#editor-tabs li').removeClass('active');b.addClass('active');r(a);}function t(b,c){var d=b.copy(),e=c.toLowerCase(),f=b.view_form.find('li#'+e),g=b.item_info[c],h;h=b.view_form.find('#editor-tabs #info-grids > div.'+e);if(h.length)h.empty();else{h=a('<div id="'+e+'" class="info-tree '+e+'">');b.view_form.find('#editor-tabs #info-grids').append(h);}h.hide();d.open({open_empty:true});u(d,g,0);d.disable_controls();try{d.create_tree(h,{id_field:'id',parent_field:'parent',text_field:'name',parent_of_root_value:0});}finally{d.enable_controls();}}function u(a,b,c){var d=[],e=0;for(var f in b)d.push(f);d=d.sort();e=c+1;if(d.length)for(var g=0;g<d.length;g++){a.append();a.id.value=e;a.parent.value=c;a.name.value=d[g];a.post();if(b[d[g]]!==null&&typeof b[d[g]]==='object')e=u(a,b[d[g]],e);e++;}return e;}function v(a){a.task.sys_search.find_in_task(b);}function w(a,b){var c=(b.keyCode?b.keyCode:b.which);if(c===27)if(!a.view_form.find('.ace_search').is(':visible'))a.close_view_form();if(b.ctrlKey&&c===83){b.preventDefault();b.stopPropagation();l(a);}if(b.altKey&&c===70){b.preventDefault();b.stopPropagation();v(a);}}this.code_editor=c;this.file_editor=d;this.on_view_form_created=e;this.on_view_form_shown=f;this.get_modified=g;this.mark_clean=h;this.on_view_form_close_query=i;this.save_to_field=j;this.save_to_file=k;this.save_edit=l;this.cancel_edit=m;this.update_size=n;this.resize=o;this.find_text=p;this.tree_node_clicked=q;this.update_tab_height=r;this.info_tab_clicked=s;this.add_tree=t;this.build_tree=u;this.find_in_project=v;this.on_view_form_keydown=w;}b.events.events14=new h();function i(){function b(a,b,c,d,e,f,g,h,i,j){var k=this.copy();k.item=a;k.title=b;k.source_def=c;k.source_list=d;k.dest_def=e;k.dest_list=f;k.save_func=g;k.cancel_func=h;if(i===undefined)i=true;k.can_move=i;if(j===undefined)j=false;k.read_only=j;k.view();return k;}function c(b){var c={},d,e;if(b.dest_def[1].length===4)c={'name':b.dest_def[1][3]};b.source=b.copy(),b.dest=b.copy();b.view_options.width=680;b.view_form.title=b.title;e=[];for(d=0;d<b.source_def.length;d++)if(b.source_def[d][2])e.push(b.source_def[d][0]);b.source.set_view_fields(e);e=[];for(d=0;d<b.dest_def.length;d++)if(b.dest_def[d][2])e.push(b.dest_def[d][0]);b.dest.set_view_fields(e);b.left_grid=b.dest.create_table(b.view_form.find("#left-grid"),{height:360,column_width:c,dblclick_edit:false});b.right_grid=b.source.create_table(b.view_form.find("#right-grid"),{height:360,dblclick_edit:false});b.left_grid.$table.keydown(function(a){var c=(a.keyCode?a.keyCode:a.which);if(c===32){a.preventDefault();h(b);}});b.right_grid.$table.keydown(function(a){var c=(a.keyCode?a.keyCode:a.which);if(c===32){a.preventDefault();g(b);}});if(!b.can_move)b.view_form.find("#vert-btns-box").hide();b.view_form.find("#up-btn").attr('tabindex',-1).click(function(){b.task.move_record_up(b.dest);});b.view_form.find("#down-btn").attr('tabindex',-1).click(function(){b.task.move_record_down(b.dest);});b.view_form.find("#left-btn").attr('tabindex',-1).click(function(){g(b);});b.view_form.find("#right-btn").attr('tabindex',-1).click(function(){h(b);});b.view_form.find("#cancel-btn").attr("tabindex",101).text(b.task.language.cancel).on('click.task',function(a){k(b);});b.view_form.find("#ok-btn").attr("tabindex",100).text(b.task.language.ok).on('click.task',function(){i(b);});if(b.read_only)b.view_form.find("button.arrow_btn").hide();b.left_grid.$table.on('click','td',function(){var c=a(this),d=c.data('field_name'),e=b.dest.field_by_name(d);if(e.field_type==="boolean"){if(!b.dest.is_changing())b.dest.edit();e.value=!e.value;b.dest.post();}});}function d(a){e(a);a.right_grid.focus();}function e(a){var b,c,d,e,f,g;a.source.disable_controls();try{a.source.open({open_empty:true});for(b=0;b<a.source_def.length;b++)if(a.source_def[b][2])a.source.field_by_name(a.source_def[b][0]).field_caption=a.source_def[b][1];for(b=0;b<a.source_list.length;b++){e=a.source_list[b];g=false;for(c=0;c<a.dest_list.length;c++){f=a.dest_list[c];if(e[0]===f[0]){g=true;break;}}if(!g){a.source.append();for(d=0;d<a.source_def.length;d++)a.source.field_by_name(a.source_def[d][0]).value=e[d];a.source.post();}}a.source.first();}finally{a.source.enable_controls();}a.source.update_controls();a.dest.disable_controls();try{a.dest.open({open_empty:true});for(b=0;b<a.dest_def.length;b++)if(a.dest_def[b][2])a.dest.field_by_name(a.dest_def[b][0]).field_caption=a.dest_def[b][1];for(b=0;b<a.dest_list.length;b++){f=a.dest_list[b];g=false;for(c=0;c<a.source_list.length;c++){e=a.source_list[c];if(e[0]===f[0]){g=true;break;}}if(g){a.dest.append();a.dest.id.value=e[0];a.dest.name.value=e[1];for(d=2;d<a.dest_def.length;d++)a.dest.field_by_name(a.dest_def[d][0]).value=f[d-1];a.dest.post();}}a.dest.first();}finally{a.dest.enable_controls();}a.dest.update_controls();}function f(a,b){if(a.record_count()){b.append();b.id.value=a.id.value;b.name.value=a.name.value;b.post();a["delete"]();}}function g(a){f(a.source,a.dest);}function h(a){f(a.dest,a.source);}function i(a){var b=[];a.dest.each(function(c){var d,e=[];e.push(c.id.value);for(d=2;d<a.dest_def.length;d++)e.push(a.dest.field_by_name(a.dest_def[d][0]).value);b.push(e);});a.close_view_form();a.save_func(a.item,b);}function j(a){if(a.item.is_changing())if(a.cancel_func)a.cancel_func(a.item);}function k(a){a.close_view_form();}function l(a,b){if(b.keyCode===13){b.preventDefault();i(a);}}this.fields_editor=b;this.on_view_form_created=c;this.on_view_form_shown=d;this.prepare_grids=e;this.move_hor=f;this.move_left=g;this.move_right=h;this.save_result=i;this.on_view_form_close_query=j;this.item_cancel=k;this.on_view_form_keydown=l;}b.events.events15=new i();function j(){function a(a){if(b.init_project&&a.f_language.value){a.task.server('server_set_project_langage',[a.f_language.value]);location.reload();}}function c(a){if(a.params)a.edit_options.width=460;a.edit_form.find('.f_version').width('30%');a.edit_form.find('.control-label').width(200);a.edit_form.find('.controls').css('margin-left',230);}function d(a){if(a.field_name==='f_con_pool_size'&&a.value<1)return 'The Connection pool size value must be greater than zero';}this.on_after_apply=a;this.on_edit_form_created=c;this.on_field_validate=d;}b.events.events11=new j();function k(){function c(a){var b=a.sys_search.copy();b.open({open_empty:true});b.set_edit_fields(['find_text','case_sensitive','whole_words']);b.append_record();}function d(a){a.edit_form.title=b.language.find;a.edit_form.find("#cancel-btn").text(b.language.close).attr("tabindex",101);a.edit_form.find("#ok-btn").text(b.language.find).attr("tabindex",100).off('click.task').on('click',function(){e(a);});}function e(c){var d,e,f,g,h=a(window).width()-50,i=a(window).height()-200,j=a('<div>');if(c.find_text.value){d=c.task.server('server_find_in_task',[c.task.sys_tasks.task_id.value,c.find_text.value,c.case_sensitive.value,c.whole_words.value]);if(d){j.append(a('<h4>Client</h4>'));g=d.client.split('\n');for(e=0;e<g.length;e++){f=a('<p style="margin: 0px;">').text(g[e]);f.css("font-family","'Courier New', Courier, monospace");j.append(f);}j.append(a('<h4>Server</h4>'));g=d.server.split('\n');for(e=0;e<g.length;e++){f=a('<p style="margin: 0px;">').text(g[e]);f.css("font-family","'Courier New', Courier, monospace");j.append(f);}b.message(j,{title:'Search result',margin:10,width:h,height:i,text_center:false,buttons:{"Close":undefined},center_buttons:false,print:true});}}}function f(a,b){if(b.keyCode===13){b.preventDefault();a.edit_form.find("#ok-btn").focus();e(a);}}this.find_in_task=c;this.on_edit_form_created=d;this.find=e;this.on_edit_form_keydown=f;}b.events.events16=new k();function l(){function a(a){a.view_form.find('#up-btn').click(function(){a.task.move_record_up(a);});a.view_form.find('#down-btn').click(function(){a.task.move_record_down(a);});}function b(a){}function c(a){a.task_id.value=a.task.sys_items.task_id.value;a.owner_id.value=0;a.f_visible.value=true;a.f_index.value=a.record_count();a.f_type.value=1;}function d(a){a.owner_rec_id.value=a.task.sys_items.id.value;a.owner.value=a.task.sys_items.ID;}function e(a,b){var c,d=a.owner;if(a.field_name==='f_field'){c=d.task.sys_fields.copy();c.set_where({id:a.value});c.open();d.f_name.value=c.f_name.value;d.f_filter_name.value=c.f_field_name.value;}}function f(a,b){var c,d=a.owner;if(a.field_name==='f_field'){c=d.copy();b.filters.owner_rec_id.value=[d.task.sys_items.id.value,d.task.sys_items.parent.value];b.filters.master_field_is_null.value=true;b.set_view_fields(['f_field_name','f_name']);b.set_order_by(['f_field_name']);}}function g(a){var b=0;a.each(function(a){a.edit();a.f_index.value=b;a.post();b++;});a.apply();}this.on_view_form_created=a;this.on_view_form_shown=b;this.on_after_append=c;this.on_before_post=d;this.on_field_changed=e;this.on_field_select_value=f;this.on_view_form_close_query=g;}b.events.events5=new l();function m(){function a(a){a.view_form.find("#edit-btn").text(a.task.language.view);if(a.filters.foreign_index.value){a.f_index_name.field_caption='Foreign key';a.set_view_fields(['f_foreign_field','f_index_name']);a.set_edit_fields(['f_foreign_field','f_index_name']);a.f_foreign_field.required=true;a.f_index_name.required=true;}else{a.f_index_name.field_caption='Index';a.set_view_fields(['f_index_name','descending']);a.set_edit_fields(['f_index_name','descending']);a.f_foreign_field.required=false;a.view_form.find("#new-btn").off('click.task');a.view_form.find("#edit-btn").off('click.task');a.view_form.find("#new-btn").on('click.task',function(){c(a,true);});a.view_form.find("#edit-btn").on('click.task',function(){c(a,false);});a.view_table.on_dblclick=function(){c(a,false);};}}function b(a,b){if(b.keyCode===45&&b.ctrlKey===true){b.preventDefault();if(a.filters.foreign_index.value)a.append_record();else c(a,true);}else if(b.keyCode===46&&b.ctrlKey===true){b.preventDefault();a.delete_record();}}function c(a,b){var c,d=[],e=[],f=[],g='';function h(a,c){var d;if(b){if(!a.f_index_name.value)d=a.task.language.index_name_required;if(!c.length)d=a.task.language.index_fields_required;if(d){a.warning(d);throw d;}a.f_fields.value=a.server('server_dump_index_fields',[c]);a.post();try{a.apply();}catch(e){a.warning(e);throw e;}}else{a.read_only=false;a.cancel();}}function i(a){a.read_only=false;a.cancel();}if(b){a.append();a.read_only=false;}else if(a.record_count()>0){a.edit();a.read_only=true;f=a.server('server_load_index_fields',[a.f_fields.value]);}else return;d=[['id','',false],['name',a.task.language.caption_name,true]];e=[['id','',false],['name',a.task.language.caption_name,true]];c=a.task.sys_fields_editor.fields_editor(a,g,d,a.task.sys_items.get_fields_list(a.task),e,f,h,i,undefined,!b);a.create_inputs(c.view_form.find('div#fields-container'));}function d(a){var b=a.task.task_name,c=a.task.sys_items.f_item_name.value;if(!a.filters.foreign_index.value)a.f_index_name.value=b.toUpperCase()+'_'+c.toUpperCase()+'_'+'IDX';a.task_id.value=a.task.sys_items.task_id.value;a.owner_rec_id.value=a.task.sys_items.id.value;a.f_foreign_index.value=a.filters.foreign_index.value;}function e(a,b){function c(b){var c,d,e;if(b.f_object.value&&!b.f_master_field.value){e=b.task.sys_items.field_by_id(b.f_object.value,'f_soft_delete');if(!e){c=a.owner.clone();d=true;c.each(function(a){if(a.f_foreign_field.value==b.id.value){d=false;return false;}});return d;}}}b.view_options.fields=['f_nane','f_field_name'];b.on_filter_record=c;b.filtered=true;}function f(a,b){var c=a.owner;if(a.field_name==='f_foreign_field')c.f_index_name.value='FK_'+c.task.sys_items.f_table_name.value.toUpperCase()+'_'+a.display_text.toUpperCase();}function g(a){var b=a.owner,c='',d;if(a.field_name==='f_index_name'){d=b.clone();d.each(function(d){if(b.rec_no!==d.rec_no&&a.value===d.f_index_name.value){c='There is index with this name';return false;}});if(c)return c;}}this.on_view_form_created=a;this.on_view_form_keydown=b;this.edit_index=c;this.on_after_append=d;this.on_field_select_value=e;this.on_field_changed=f;this.on_field_validate=g;}b.events.events10=new m();function n(){function a(a){a.task.sys_filters.on_view_form_created(a);}function b(a){a.task.sys_filters.on_view_form_close_query(a);}function c(a){a.task.sys_filters.on_before_post(a);}function d(a){a.task_id.value=a.task_id.value;a.f_data_type.read_only=false;a.f_visible.value=true;}function e(a,b){var c=a.owner;c.task.sys_items.sys_fields.on_field_changed(a,b);if(a.field_name==='f_object_field'){if(!c.f_name.value)c.f_name.value=b.f_name.value;if(!c.f_param_name.value)c.f_param_name.value=b.f_field_name.value;}}function f(a,b){a.owner.task.sys_items.sys_fields.on_field_select_value(a,b);}function g(a){a.owner.task.sys_items.sys_fields.on_field_validate(a);}this.on_view_form_created=a;this.on_view_form_close_query=b;this.on_before_post=c;this.on_after_append=d;this.on_field_changed=e;this.on_field_select_value=f;this.on_field_validate=g;}b.events.events12=new n();function o(){function a(a){a.lookup_field=null;a.log_changes=false;a.view_options.title='Field Lookup Values';a.edit_options.title='Field Lookup Values';a.view_options.width=660;a.view_options.fields=['f_value','f_lookup'];a.edit_options.fields=['f_value','f_lookup'];a.view_form.find('#up-btn').click(function(){a.task.move_record_up(a);});a.view_form.find('#down-btn').click(function(){a.task.move_record_down(a);});}function b(a){var b=a.task.sys_items.sys_fields.f_lookup_values_text.value,c=[];if(b){c=JSON.parse(b);for(var d=0;d<c.length;d++){a.append();a.f_value.value=c[d][0];a.f_lookup.value=c[d][1];a.post();}}}function c(a){var b,c;if(a.record_count()){b=[];a.each(function(a){b.push([a.f_value.value,a.f_lookup.value]);});}a.task.sys_items.sys_fields.f_lookup_values.value=a.record_count();a.task.sys_items.sys_fields.f_lookup_values_text.value=JSON.stringify(b);}function d(a){if(a.field_name==='f_value'&&a.value===0)return 'Value must be greater than zero';}this.on_view_form_created=a;this.on_view_form_shown=b;this.on_view_form_close_query=c;this.on_field_validate=d;}b.events.events17=new o();function p(){function a(a){function b(){var b=false,c;if(a.owner.id.value&&a.id.value){c=a.task.sys_indices;c.set_where({owner_rec_id:a.owner.id.value});c.open();c.each(function(c){if(c.f_foreign_index.value&&c.f_foreign_field.value===a.id.value)b=true;});}return b;}a.edit_options.title='Field Editor';if(!a.is_new())a.edit_options.title+=' - '+a.f_name.value;a.f_field_name.read_only=a.f_field_name.value==='id'||a.f_field_name.value==='deleted'||a.f_field_name.value==='owner_id'||a.f_field_name.value==='owner_rec_id';a.f_data_type.read_only=false;a.f_size.read_only=false;a.f_object.read_only=false;a.f_object_field.read_only=false;a.f_master_field.read_only=false;a.f_lookup_values.read_only=true;f(a);if(b())a.f_object.read_only=true;}function b(a,b){var c=a.owner,d,e;if(b.item_name==='sys_items')b.set_view_fields(['id','f_item_name','f_name']);else if(b.item_name==='sys_fields')b.set_view_fields(['f_field_name','f_name']);if(a===c.f_object){if(c.owner===c.task.sys_items){b.filters.not_id.value=c.owner.id.value;if(c.owner.type_id.value===c.task.item_types.TASK_TYPE)b.filters.task_id.value=c.owner.id.value;else b.filters.task_id.value=c.owner.task_id.value;}b.set_order_by(['f_item_name']);b.filters.type_id.value=[c.task.item_types.CATALOG_TYPE,c.task.item_types.JOURNAL_TYPE,c.task.item_types.TABLE_TYPE];b.filters.table_id.value=0;}else if(a.field_name==='f_master_field'&&c.f_object.value){d=c.owner.id.value;e=c.task.sys_items.field_by_id(d,'parent');b.filters.owner_rec_id.value=[d,e];b.filters.not_id.value=c.id.value;b.filters.object.value=c.f_object.value;b.filters.master_field_is_null.value=true;}if(a.field_name==='f_object_field')if(c.f_object.value){d=c.f_object.value;e=c.task.sys_items.field_by_id(d,'parent');b.filters.owner_rec_id.value=[d,e];b.set_order_by(['f_field_name']);}else b.filters.owner_rec_id.value=[-1];}function c(a,b){var c='',d,e;if(!a.owner.valid_identifier(b))c=a.task.language.invalid_field_name;d=a.clone();d.each(function(d){if(a.rec_no!==d.rec_no&&b===d.f_field_name.value){c='There is a field with this name';return false;}});e=new a.task.constructors.item();if(e[b]!==undefined)c=a.task.language.reserved_word;return c;}function d(a){var b=a.owner,d='';if(a.field_name==='f_field_name'){d=c(b,a.value);if(d)return d;}else if(a.field_name==='f_object_field'){if(b.f_object.value&&!a.value)return b.task.language.object_field_required;}else if(a.field_name==='f_data_type'&&b.f_data_type.value===0)return b.task.language.type_is_required;}function e(a){var b=a.owner,c;if(a.field_name==='f_name'){if(b.f_field_name){if(!b.f_field_name.value)try{c=a.text.replace(' ','_').toLowerCase();if(b.owner.valid_identifier(c))b.f_field_name.value=c;}catch(d){}}else if(b.f_param_name)if(!b.f_param_name.value)try{c=a.text.replace(' ','_').lower();if(b.owner.valid_identifier(c))b.f_param_name.value=c;}catch(d){}}else if(a===b.f_object){b.f_object_field.value=null;b.f_master_field.value=null;if(b.f_object.value)b.f_data_type.value=b.task.consts.INTEGER;else b.f_enable_typehead.value=null;}else if(a===b.f_master_field){if(a.value)b.f_enable_typehead.value=null;}else if(a===b.f_lookup_values){b.f_object_field.value=null;b.f_lookup_values_text.value=null;if(b.f_lookup_values.value)b.f_data_type.value=b.task.consts.INTEGER;else b.f_data_type.value=null;}else if(a===b.f_data_type){if(b.f_data_type.value===b.task.consts.TEXT)b.f_size.value=10;else b.f_size.value=null;if(b.f_data_type.value!==b.task.consts.INTEGER){b.f_lookup_values.value=null;b.f_lookup_values_text.value=null;}}if(a===b.f_data_type||a===b.f_object||a===b.f_lookup_values)b.f_alignment.value=g(b);f(b);}function f(a){if(a.id.value&&!a.owner.f_virtual_table.value&&!a.task.sys_tasks.f_manual_update.value){a.f_data_type.read_only=!a.task.db_options.CAN_CHANGE_TYPE;a.f_size.read_only=true;if(a.f_data_type.value===a.task.consts.TEXT)a.f_size.read_only=!a.task.db_options.CAN_CHANGE_SIZE;a.f_object.read_only=true;a.f_object_field.read_only=true;a.f_master_field.read_only=true;a.f_lookup_values.read_only=true;a.f_enable_typehead.read_only=true;if(a.f_data_type.value===a.task.consts.INTEGER)if(a.f_object.value){a.f_object_field.read_only=false;a.f_master_field.read_only=false;if(a.f_object_field.value&&!a.f_master_field.value)a.f_enable_typehead.read_only=false;a.f_lookup_values.read_only=true;}else if(a.f_lookup_values.value)a.f_lookup_values.read_only=false;else a.f_lookup_values.read_only=false;}else{a.f_enable_typehead.read_only=true;if(!a.f_data_type.value){a.f_data_type.read_only=false;a.f_lookup_values.read_only=false;a.f_object.read_only=false;a.f_object_field.read_only=false;a.f_master_field.read_only=false;}else if(a.f_data_type.value===a.task.consts.INTEGER){if(a.f_object.value){a.f_lookup_values.read_only=true;if(a.f_object_field.value&&!a.f_master_field.value)a.f_enable_typehead.read_only=false;a.f_data_type.read_only=true;}else if(a.f_lookup_values.value){a.f_data_type.read_only=true;a.f_object.read_only=true;a.f_object_field.read_only=true;a.f_master_field.read_only=true;a.f_lookup_values.read_only=false;}else{a.f_data_type.read_only=false;a.f_lookup_values.read_only=false;a.f_object.read_only=false;a.f_object_field.read_only=false;a.f_master_field.read_only=false;}}else{a.f_lookup_values.read_only=true;a.f_object.read_only=true;a.f_object_field.read_only=true;a.f_master_field.read_only=true;}if(a.f_data_type.value===a.task.consts.TEXT)a.f_size.read_only=false;else a.f_size.read_only=true;}}function g(a){var b=a.f_data_type.value,c;if(b===a.task.consts.INTEGER||b===a.task.consts.FLOAT||b===a.task.consts.CURRENCY)c=a.task.consts.ALIGN_RIGHT;else if(b===a.task.consts.DATE||b===a.task.consts.DATETIME)c=a.task.consts.ALIGN_CENTER;else c=a.task.consts.ALIGN_LEFT;if(a.f_object.value||a.f_lookup_values.value)c=a.task.consts.ALIGN_LEFT;return c;}function h(a){if(a.id.value)return a.task.sys_fields.server('server_can_delete_field',[a.id.value]);}function i(a){a.f_data_type.read_only=false;}function j(a){if(a.f_data_type.value!==a.task.consts.TEXT)a.f_size.value=null;a.task_id.value=a.task.item_tree.task_id.value;}function k(a){}function l(a){}function m(a){if(a.field_name==='f_size'&&a.value===0)return '';if(a.field_name==='f_lookup_values')if(a.value)return a.value+' items';}function n(a,b,c){var d=a.owner;if(a.field_name==='f_lookup_values')if(a.value!=null&&a.new_value==null&&!d.f_lookup_values_changing){d.question('Clear the lookup value list?',function(){try{d.f_lookup_values_changing=true;d.f_lookup_values.value=null;d.f_lookup_values_text.value=null;}finally{d.f_lookup_values_changing=undefined;}});a.new_value=a.value;}}this.on_edit_form_created=a;this.on_field_select_value=b;this.check_valid_field_name=c;this.on_field_validate=d;this.on_field_changed=e;this.update_fields_read_only=f;this.get_alignment=g;this.can_delete=h;this.on_after_append=i;this.on_before_post=j;this.on_before_edit=k;this.on_after_scroll=l;this.on_get_field_text=m;this.on_before_field_changed=n;}b.events.events6=new p();function q(){function a(a,b){var c=a.owner;c.post();c.owner.post();if(c.id.value)c.record_status=c.task.consts.RECORD_MODIFIED;else c.record_status=c.task.consts.RECORD_INSERTED;c.owner.apply();c.owner.edit();}this.on_field_changed=a;}b.events.events8=new q();})(jQuery,task);